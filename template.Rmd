---
title: "STAT 345 Address Final Project"
output: word_document
date: "2025-11-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One

_Maps_ The US Census Bureau provides mapping shape files for a variety of variables across the entire United States. You can explore these at [https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html](https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html). Make a map that displays county boundaries for the entire United States. You may use whichever package for plotting that you'd like, though you might find the 'ggmap' and 'rdgal' packages (and related tutorials) informative here.

```{r Isaac}
67

```


## Section Two

2. _Roads_ Your goal in this step is to summarize (tabulate) the road suffixes for each county in the United States. County-level data can be found at [https://www2.census.gov/geo/tiger/TIGER2023/ROADS/](https://www2.census.gov/geo/tiger/TIGER2023/ROADS/). There are over 3000 files here, with file names that include the 5-digit GEOID for the county. As you process this data, you'll need to manage your memory in R. You'll likely want to download the file, unzip it, read it, summarize it, and then remove the file from memory. This is a great place for a function! Be sure to include the GEOID in your summary data for the next step.

```{r James}
# install.packages(c("sf", "ggplot2"))
library(sf)
library(ggplot2)

url <- "https://www2.census.gov/geo/tiger/TIGER2025/COUNTY/tl_2025_us_county.zip"
td <- tempdir()
zipfile <- file.path(td, "tl_2025_us_county.zip")
download.file(url, zipfile, mode = "wb")
unzip(zipfile, exdir = td)

shp <- list.files(td, pattern = "tl_2025_us_county\\.shp$", full.names = TRUE)
us_counties <- st_read(shp, quiet = TRUE)
```
```{r}
ggplot(us_counties) +
  geom_sf(fill = NA, color = "gray30", linewidth = 0.1) +
  theme_void()


```
```{r}
library(rvest)
library(stringr)

base_url <- "https://www2.census.gov/geo/tiger/TIGER2023/ROADS/"

# Scrape the directory listing
page <- read_html(base_url)

# Extract only valid county road ZIPs
zip_links <- page %>%
  html_nodes("a") %>%
  html_attr("href") %>%
  na.omit() %>%
  str_subset("^tl_2023_\\d{5}_roads\\.zip$")

# Build full URLs
zip_urls <- paste0(base_url, zip_links)

head(zip_urls)

test_url <- zip_urls[1]
download.file(test_url, "test.zip", mode = "wb")
unzip("test.zip", list = TRUE)   # check contents
```
```{r}
library(sf)
library(dplyr)

process_county_roads <- function(url, outdir = "roads_temp") {
  dir.create(outdir, showWarnings = FALSE)
  geoid <- stringr::str_extract(basename(url), "\\d{5}")
  
  zipfile <- file.path(outdir, basename(url))
  
  # Download
  tryCatch({
    download.file(url, zipfile, mode = "wb", quiet = TRUE)
  }, error = function(e) {
    warning("Download failed for ", url)
    return(NULL)
  })
  
  # Skip if empty
  if (!file.exists(zipfile) || file.size(zipfile) == 0) {
    warning("Empty file for ", url)
    return(NULL)
  }
  
  # Unzip
  unzip(zipfile, exdir = outdir)
  
  shp <- list.files(outdir, pattern = "\\.shp$", full.names = TRUE)
  if (length(shp) == 0) {
    warning("No shapefile found in ", zipfile)
    return(NULL)
  }
  
  # Read shapefile
  roads <- st_read(shp[1], quiet = TRUE)
  
  # Summarize suffixes
  suffixes <- roads %>%
    st_drop_geometry() %>%
    mutate(suffix = stringr::word(FULLNAME, -1)) %>%
    count(suffix, name = "n") %>%
    mutate(GEOID = geoid)
  
  # Clean up
  unlink(list.files(outdir, full.names = TRUE))
  gc()
  
  return(suffixes)
}
process_county_roads(zip_urls)
```
## Section Three

3. _Putting it Together_ Merge the county shape files with your county-level summaries. The main plot to create for the project is to color your map from step 1 based on the most common road suffix (summary from step 2). Beyond this plot, feel free to be creative when making at least two additional plots.

```{r Blake}

# install.packages(c("tigris", "sf", "ggplot2"))
library(tigris)
library(sf)
library(ggplot2)

options(tigris_use_cache = TRUE)

# 1) Get all US counties as sf
us_counties <- counties(cb = FALSE, class = "sf")  # detailed TIGER geometry

# 2) Shift AK/HI/PR for a standard US layout (optional)
us_counties_shift <- shift_geometry(us_counties, preserve_area = FALSE, position = "below")

# 3) Plot with an equal-area CONUS projection (EPSG:5070)
ggplot(us_counties_shift) +
  geom_sf(fill = NA, color = "gray30", linewidth = 0.1) +
  coord_sf(crs = 5070) +
  theme_void()


```



## Section Four

```{r student4}

```